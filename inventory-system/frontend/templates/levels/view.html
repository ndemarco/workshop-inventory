{% extends "base.html" %}

{% block title %}{{ level.module.name }} - Level {{ level.level_number }} - Homelab Inventory{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <nav class="breadcrumb">
            <a href="{{ url_for('modules.list_modules') }}">Modules</a> /
            <a href="{{ url_for('modules.view_module', module_id=level.module_id) }}">{{ level.module.name }}</a> /
            Level {{ level.level_number }}
        </nav>
        <h1>Level {{ level.level_number }}{% if level.name %} - {{ level.name }}{% endif %}</h1>
    </div>
    <div class="header-actions">
        <a href="{{ url_for('modules.edit_level', level_id=level.id) }}" class="btn btn-secondary">Edit</a>
    </div>
</div>

{% if level.description %}
<div class="level-description">
    <p>{{ level.description }}</p>
</div>
{% endif %}

<div class="level-stats">
    <span class="badge">Grid: {{ level.rows }} Ã— {{ level.columns }}</span>
    <span class="badge">{{ level.locations|length }} locations</span>
</div>

<h2>Location Grid</h2>

<div class="location-grid">
    <table class="grid-table">
        <thead>
            <tr>
                <th></th>
                {% for col in range(1, level.columns + 1) %}
                <th>{{ col }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for row_idx in range(level.rows) %}
            {% set row = [chr(65 + row_idx)] if level.rows <= 26 else [row_idx + 1|string] %}
            <tr>
                <th>{{ row[0] }}</th>
                {% for col in range(1, level.columns + 1) %}
                {% set col_str = col|string %}
                {% set location = location_grid.get(row[0], {}).get(col_str) %}
                <td class="grid-cell {% if location and location.item_locations %}occupied{% else %}empty{% endif %}">
                    {% if location %}
                    <a href="{{ url_for('locations.view_location', location_id=location.id) }}" class="location-link">
                        <div class="location-address">{{ row[0] }}{{ col }}</div>
                        {% if location.item_locations %}
                        <div class="location-items">{{ location.item_locations|length }} item(s)</div>
                        {% else %}
                        <div class="location-empty">Empty</div>
                        {% endif %}
                    </a>
                    {% else %}
                    <div class="location-missing">-</div>
                    {% endif %}
                </td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="grid-legend">
    <div class="legend-item">
        <span class="legend-color occupied"></span> Occupied
    </div>
    <div class="legend-item">
        <span class="legend-color empty"></span> Empty
    </div>
</div>

{% endblock %}
