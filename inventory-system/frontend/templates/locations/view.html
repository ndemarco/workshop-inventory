{% extends "base.html" %}

{% block title %}{{ location.full_address() }} - Homelab Inventory{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <nav class="breadcrumb">
            <a href="{{ url_for('modules.list_modules') }}">Modules</a> /
            <a href="{{ url_for('modules.view_module', module_id=location.level.module_id) }}">{{ location.level.module.name }}</a> /
            <a href="{{ url_for('modules.view_level', level_id=location.level_id) }}">Level {{ location.level.level_number }}</a> /
            {{ location.row }}{{ location.column }}
        </nav>
        <h1>üìç {{ location.full_address() }}</h1>
    </div>
    <div class="header-actions">
        <a href="{{ url_for('locations.edit_location', location_id=location.id) }}" class="btn btn-secondary">Edit</a>
    </div>
</div>

<div class="location-details">
    <div class="detail-grid">
        <div class="detail-item">
            <strong>Type:</strong>
            <span>{{ location.location_type }}</span>
        </div>

        {% if location.width_mm or location.height_mm or location.depth_mm %}
        <div class="detail-item">
            <strong>Dimensions:</strong>
            <span>
                {% if location.width_mm %}W: {{ location.width_mm }}mm{% endif %}
                {% if location.height_mm %} H: {{ location.height_mm }}mm{% endif %}
                {% if location.depth_mm %} D: {{ location.depth_mm }}mm{% endif %}
            </span>
        </div>
        {% endif %}

        <div class="detail-item">
            <strong>Status:</strong>
            <span class="{% if item_locations %}badge-occupied{% else %}badge-empty{% endif %}">
                {% if item_locations %}Occupied ({{ item_locations|length }} items){% else %}Empty{% endif %}
            </span>
        </div>
    </div>

    {% if location.notes %}
    <div class="detail-section">
        <strong>Notes:</strong>
        <p>{{ location.notes }}</p>
    </div>
    {% endif %}
</div>

<h2>Items Stored Here</h2>

{% if item_locations %}
<table class="data-table">
    <thead>
        <tr>
            <th>Item</th>
            <th>Description</th>
            <th>Quantity</th>
            <th>Notes</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for il in item_locations %}
        <tr>
            <td>
                <a href="{{ url_for('items.view_item', item_id=il.item_id) }}">
                    <strong>{{ il.item.name }}</strong>
                </a>
            </td>
            <td>{{ il.item.description[:80] }}{% if il.item.description|length > 80 %}...{% endif %}</td>
            <td>{{ il.quantity }}{% if il.item.unit %} {{ il.item.unit }}{% endif %}</td>
            <td>{{ il.notes or '-' }}</td>
            <td>
                <a href="{{ url_for('items.view_item', item_id=il.item_id) }}" class="btn-link">View Item</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<div class="empty-state">
    <p>This location is empty.</p>
</div>
{% endif %}

{% endblock %}
