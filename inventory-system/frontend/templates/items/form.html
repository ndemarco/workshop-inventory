{% extends "base.html" %}

{% block title %}{% if item %}Edit{% else %}New{% endif %} Item - Homelab Inventory{% endblock %}

{% block content %}
<div class="page-header">
    <h1>{% if item %}Edit Item{% else %}New Item{% endif %}</h1>
</div>

<form method="POST" class="form">
    <div class="form-group">
        <label for="name">Name *</label>
        <input type="text" id="name" name="name" value="{{ item.name if item else '' }}" required>
    </div>

    <div class="form-group">
        <label for="description">Description *</label>
        <textarea id="description" name="description" rows="4" required>{{ item.description if item else '' }}</textarea>
        <small>Natural language description of the item</small>
    </div>

    <div class="form-row">
        <div class="form-group">
            <label for="category">Category</label>
            <input type="text" id="category" name="category" value="{{ item.category if item else '' }}" list="categories">
            <datalist id="categories">
                <option value="Electronics">
                <option value="Fasteners">
                <option value="Tools">
                <option value="Paints & Coatings">
                <option value="Hardware">
                <option value="Materials">
            </datalist>
        </div>

        <div class="form-group">
            <label for="item_type">Item Type</label>
            <input type="text" id="item_type" name="item_type" value="{{ item.item_type if item else '' }}" list="item_types">
            <datalist id="item_types">
                <option value="solid">
                <option value="liquid">
                <option value="smd_component">
                <option value="bulk">
                <option value="tool">
            </datalist>
        </div>
    </div>

    <div class="form-row">
        <div class="form-group">
            <label for="quantity">Quantity</label>
            <input type="number" id="quantity" name="quantity" value="{{ item.quantity if item else 1 }}" min="0">
        </div>

        <div class="form-group">
            <label for="unit">Unit</label>
            <input type="text" id="unit" name="unit" value="{{ item.unit if item else '' }}" placeholder="pieces, meters, etc.">
        </div>

        <div class="form-group">
            <label for="min_quantity">Min Quantity (Alert)</label>
            <input type="number" id="min_quantity" name="min_quantity" value="{{ item.min_quantity if item else '' }}" min="0">
        </div>
    </div>

    <div class="form-group">
        <label for="tags">Tags</label>
        <input type="text" id="tags" name="tags" value="{{ item.tags if item else '' }}" placeholder="metric, stainless, m6, bolt">
        <small>Comma-separated tags</small>
    </div>

    <div class="form-group">
        <label for="notes">Notes</label>
        <textarea id="notes" name="notes" rows="3">{{ item.notes if item else '' }}</textarea>
    </div>

    {% if not item %}
    <h3>Initial Location</h3>
    <div class="form-row">
        <div class="form-group">
            <label for="location_select">Location</label>
            <select id="location_select" name="location_id">
                <option value="">Select later...</option>
                {% for module in modules %}
                    <optgroup label="{{ module.name }}">
                    {% for level in module.levels %}
                        {% for location in level.locations %}
                            <option value="{{ location.id }}">{{ location.full_address() }}</option>
                        {% endfor %}
                    {% endfor %}
                    </optgroup>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label for="location_quantity">Quantity at Location</label>
            <input type="number" id="location_quantity" name="location_quantity" value="1" min="1">
        </div>
    </div>
    {% endif %}

    <div class="form-actions">
        <button type="submit" class="btn btn-primary">{% if item %}Update{% else %}Create{% endif %} Item</button>
        <a href="{% if item %}{{ url_for('items.view_item', item_id=item.id) }}{% else %}{{ url_for('items.list_items') }}{% endif %}" class="btn btn-secondary">Cancel</a>
    </div>
</form>

{% if item %}
<div class="danger-zone">
    <h3>Danger Zone</h3>
    <form method="POST" action="{{ url_for('items.delete_item', item_id=item.id) }}" onsubmit="return confirm('Are you sure you want to delete this item?');">
        <button type="submit" class="btn btn-danger">Delete Item</button>
    </form>
</div>
{% endif %}
{% endblock %}
