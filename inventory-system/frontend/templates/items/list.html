{% extends "base.html" %}

{% block title %}Items - Homelab Inventory{% endblock %}

{% block content %}
<div class="page-header">
    <h1>üì¶ Inventory Items</h1>
    <a href="{{ url_for('items.new_item') }}" class="btn btn-primary">+ Add Item</a>
</div>

<div class="filters">
    <form method="GET" class="filter-form">
        <input type="text" name="search" placeholder="Search items..." value="{{ request.args.get('search', '') }}">
        <select name="category">
            <option value="">All Categories</option>
            {% for cat in categories %}
            <option value="{{ cat }}" {% if request.args.get('category') == cat %}selected{% endif %}>{{ cat }}</option>
            {% endfor %}
        </select>
        <button type="submit" class="btn btn-secondary">Filter</button>
        <a href="{{ url_for('items.list_items') }}" class="btn btn-secondary">Clear</a>
    </form>
</div>

{% if filtered_location %}
<div class="banner banner-info" style="margin-bottom: 1rem;">
    <div class="banner-content">
        <strong>üìç Filtered by location:</strong> {{ filtered_location.full_address() }}
    </div>
    <a href="{{ url_for('items.list_items') }}" class="btn btn-sm btn-secondary" style="margin-left: 1rem;">Clear Filter</a>
</div>
{% endif %}

{% if items %}
<table class="data-table">
    <thead>
        <tr>
            <th>Name</th>
            <th>Description</th>
            <th>Category</th>
            <th>Quantity</th>
            <th>Locations</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for item in items %}
        <tr>
            <td><strong>{{ item.name }}</strong></td>
            <td>{{ item.description[:100] }}{% if item.description|length > 100 %}...{% endif %}</td>
            <td>{{ item.category or '-' }}</td>
            <td>{{ item.quantity }} {{ item.unit }}</td>
            <td>
                {% if item.item_locations %}
                    {% for il in item.item_locations %}
                        <a href="{{ url_for('items.list_items', location_id=il.location_id) }}" 
                           class="badge badge-link" 
                           title="Show all items at this location">
                            {{ il.location.full_address() }}
                        </a>
                    {% endfor %}
                {% else %}
                    <span class="text-muted">No location</span>
                {% endif %}
            </td>
            <td>
                <a href="{{ url_for('items.view_item', item_id=item.id) }}" class="btn-link">View</a>
                <a href="{{ url_for('items.edit_item', item_id=item.id) }}" class="btn-link">Edit</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<div class="empty-state">
    <p>No items found.</p>
    <a href="{{ url_for('items.new_item') }}" class="btn btn-primary">+ Add Item</a>
</div>
{% endif %}
{% endblock %}
