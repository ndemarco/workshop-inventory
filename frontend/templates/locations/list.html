{% extends "base.html" %}

{% block title %}Locations - WhereTF?{% endblock %}

{% block content %}
<div class="page-header">
    <h1>üìç Storage Locations</h1>
    <a href="{{ url_for('locations.new_location') }}" class="btn btn-secondary">+ Location</a>
</div>

<div class="filters">
    <form method="GET" class="filter-form">
        <select name="occupied">
            <option value="">All Locations</option>
            <option value="yes" {% if request.args.get('occupied') == 'yes' %}selected{% endif %}>Occupied Only</option>
            <option value="no" {% if request.args.get('occupied') == 'no' %}selected{% endif %}>Empty Only</option>
        </select>
        
        {% if location_types %}
        <select name="location_type">
            <option value="">All Types</option>
            {% for lt in location_types %}
            <option value="{{ lt }}" {% if request.args.get('location_type') == lt %}selected{% endif %}>{{ lt }}</option>
            {% endfor %}
        </select>
        {% endif %}
        
        <button type="submit" class="btn btn-secondary">Filter</button>
        <a href="{{ url_for('locations.list_locations') }}" class="btn btn-secondary">Clear</a>
    </form>
</div>

{% if locations %}
<table class="data-table">
    <thead>
        <tr>
            <th>Location</th>
            <th>Module</th>
            <th>Level</th>
            <th>Type</th>
            <th>Items</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for location in locations %}
        <tr>
            <td><strong>{{ location.full_address() }}</strong></td>
            <td>{{ location.level.module.name if location.level and location.level.module else '-' }}</td>
            <td>Level {{ location.level.level_number if location.level else '-' }}</td>
            <td>{{ location.location_type }}</td>
            <td>
                {% if location.item_locations %}
                    {{ location.item_locations|length }} item(s)
                {% else %}
                    <span class="text-muted">Empty</span>
                {% endif %}
            </td>
            <td>
                <a href="{{ url_for('locations.view_location', location_id=location.id) }}" class="btn-link">View</a>
                <a href="{{ url_for('locations.edit_location', location_id=location.id) }}" class="btn-link">Edit</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<div class="empty-state">
    <p>No locations found.</p>
</div>
{% endif %}
{% endblock %}
